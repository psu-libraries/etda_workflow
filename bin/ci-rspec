#!/bin/bash
export RAILS_ENV=test

# adds phantomjs for testing
yarn global add phantomjs-prebuilt

bundle exec rails db:create
bundle exec rails db:migrate

if [[ $PARTNER == "graduate" ]]; then
    if [[ $INTEGRATION == "true" ]]; then
        echo "======================================"
        echo "Running Integration Tests for Graduate"
        echo "======================================"
        PARTNER=graduate COVERAGE=true bundle exec rspec --tag js
    else
        echo "======================================"
        echo "Running Unit Tests for Graduate"
        echo "======================================"
        PARTNER=graduate COVERAGE=true bundle exec rspec --tag ~js
    fi
else
    echo "======================================"
    echo "Running Honors Specific Tests"
    echo "======================================"
    PARTNER=honors bundle exec rspec --tag honors
    echo "======================================"
    echo "Running Milsch Specific Tests"
    echo "======================================"
    PARTNER=milsch bundle exec rspec --tag milsch
    echo "======================================"
    echo "Running Sset Specific Tests"
    echo "======================================"
    PARTNER=sset bundle exec rspec --tag sset
fi